<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FOR ALL HOME CARE AND AGENCY LLC</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="api-client-googlesheets.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Lucide React icons as inline SVG components
    const Calendar = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    const ClipboardList = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
        <path d="M12 11h4"></path>
        <path d="M12 16h4"></path>
        <path d="M8 11h.01"></path>
        <path d="M8 16h.01"></path>
      </svg>
    );

    const CheckCircle = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    );

    const XCircle = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
    );

    const Download = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );

    const Trash2 = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const Users = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    );

    const FileText = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
    );

    const Info = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
    );

    const Cloud = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
      </svg>
    );

    const Shield = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
      </svg>
    );

    const Zap = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
      </svg>
    );

    // Import the component code from your JSX file
    function HomeCareAgencySystem() {
      // Check if admin mode is enabled via URL parameter
      const isAdmin = new URLSearchParams(window.location.search).get('admin') === 'true';
      
      const [activeTab, setActiveTab] = useState('appointments');
      const [showForm, setShowForm] = useState(true);
      
      // Client form state
      const [clientInfo, setClientInfo] = useState({
        evaluatorName: '',
        evaluatorSignature: '',
        parentGuardianName: '',
        clientName: '',
        serviceProviderName: '',
        email: '',
        phone: '',
        address: '',
        appointmentDate: '',
        appointmentTime: '',
        serviceType: [],
        notes: ''
      });
      
      const [evaluationType, setEvaluationType] = useState('staff');
      const [evaluationData, setEvaluationData] = useState({});
      const [errors, setErrors] = useState({});
      const [submitted, setSubmitted] = useState(false);
      
      // Data storage
      const [appointments, setAppointments] = useState([]);
      const [evaluations, setEvaluations] = useState([]);
      const [showPowerAppsInfo, setShowPowerAppsInfo] = useState(true);

      // Load data from localStorage on mount
      useEffect(() => {
        const loadData = async () => {
          // ALWAYS load from localStorage first (for GitHub Pages)
          const storedAppointments = localStorage.getItem('homeCareAppointments');
          const storedEvaluations = localStorage.getItem('homeCareEvaluations');
          
          const localApts = storedAppointments ? JSON.parse(storedAppointments) : [];
          const localEvals = storedEvaluations ? JSON.parse(storedEvaluations) : [];
          
          setAppointments(localApts);
          setEvaluations(localEvals);
          console.log('✅ Data loaded from localStorage:', localApts.length, 'appointments');

          // Also try to sync with backend API (if available)
          try {
            const [appointmentsData, evaluationsData] = await Promise.all([
              HomeCareAPI.getAppointments(),
              HomeCareAPI.getEvaluations()
            ]);
            
            // Only update if server has data (don't overwrite localStorage with empty data)
            if (appointmentsData && appointmentsData.length > 0) {
              setAppointments(appointmentsData);
              setEvaluations(evaluationsData || []);
              // Update localStorage with server data
              localStorage.setItem('homeCareAppointments', JSON.stringify(appointmentsData));
              localStorage.setItem('homeCareEvaluations', JSON.stringify(evaluationsData || []));
              console.log('✅ Data synced from server:', appointmentsData.length, 'appointments');
            } else {
              console.log('ℹ️ Server has no data, keeping localStorage data');
            }
          } catch (error) {
            console.log('ℹ️ Backend not available (using localStorage only):', error.message);
          }
        };
        
        loadData();
      }, []);

      const serviceTypes = [
        'Homemaker',
        'Personal Care',
        'Community Connection',
        'Supported Community Connection',
        'Respite',
        'Mentorship'
      ];

      const staffServiceQuestions = [
        { id: 'q1', question: 'Was the staff punctual and consistent with scheduled visits?', type: 'yesnosometimes' },
        { id: 'q2', question: 'Was the staff respectful, kind, and professional during visits?', type: 'yesnosometimes' },
        { id: 'q3', question: 'Did the staff complete all assigned duties (cleaning, laundry, cooking, outings, etc.) as expected?', type: 'yesnopartially' },
        { id: 'q4', question: 'Does the staff communicate well and follow instructions or care plans?', type: 'yesnosometimes' },
        { id: 'q5', question: 'Is the staff dressed cleanly and appropriately to provide services?', type: 'yesnosometimes' },
        { id: 'q6', question: 'Do you feel comfortable and safe having this staff in your home?', type: 'yesnosomewhat' },
        { id: 'q7', question: 'Do you feel your loved one is benefiting from the services being provided?', type: 'yesnonotsure' },
        { id: 'q8', question: 'How would you rate the quality of services received?', type: 'rating5' },
        { id: 'q9', question: 'Is your coordinator responsive and helpful in resolving any concerns?', type: 'yesnosometimes' },
        { id: 'q10', question: 'Has there been any previous incident or concern involving this staff that remains unresolved?', type: 'yesnonotsure', hasDescription: true },
        { id: 'q10_desc', question: 'If yes, please describe:', type: 'textarea', conditional: true },
        { id: 'q11', question: 'Has any inappropriate incident or behavior been reported involving this staff?', type: 'yesnonotsure', hasDescription: true },
        { id: 'q11_desc', question: 'If yes, please describe:', type: 'textarea', conditional: true },
        { id: 'q12', question: 'Has the staff failed to follow instructions or complete assigned tasks as expected?', type: 'yesnosometimes', hasDescription: true },
        { id: 'q12_desc', question: 'If yes, please describe:', type: 'textarea', conditional: true },
        { id: 'q13', question: 'Would you like to continue services with this staff?', type: 'yesnonotsure' },
        { id: 'q14', question: 'Any concerns, complaints, or suggestions for improvement?', type: 'textarea' }
      ];

      const parentalProviderQuestions = [
        { id: 'q1', question: 'Do you feel the services you provide are helping your child/family reach goals and maintain daily stability?', type: 'yesnosomewhat' },
        { id: 'q2', question: 'Since you began providing these services, have you noticed improvement in your child\'s or family\'s overall well-being?', type: 'yesnonotsure', hasDescription: true },
        { id: 'q2_desc', question: 'If yes, please describe briefly:', type: 'textarea', conditional: true },
        { id: 'q3', question: 'Does our agency provide the support, guidance, and resources you need to continue your role as a parental provider?', type: 'alwayssometimesrarely' },
        { id: 'q4', question: 'Is your assigned coordinator helpful and available when you have questions or need assistance?', type: 'yesnosometimes' },
        { id: 'q5', question: 'Are your questions about timesheets, billing, or EVV check-in/check-out answered promptly?', type: 'yesnosometimes' },
        { id: 'q6', question: 'Do you find the EVV app (check-in/check-out process) easy to use?', type: 'evvrating' },
        { id: 'q7', question: 'How would you describe your compensation?', type: 'compensation' },
        { id: 'q8', question: 'Do you believe the allotted service hours are enough to meet your client\'s needs?', type: 'yesnonotsure' },
        { id: 'q9', question: 'Would you like to continue providing services as a parental provider?', type: 'yesnoundecided' },
        { id: 'q10', question: 'Overall, how would you rate the quality of services and agency support?', type: 'rating5' },
        { id: 'q11', question: 'Do you have any complaints, challenges, or areas where the agency could improve?', type: 'textarea' },
        { id: 'q12', question: 'What suggestions or feedback would you like to share to improve the program?', type: 'textarea' }
      ];

      const currentQuestions = evaluationType === 'staff' ? staffServiceQuestions : parentalProviderQuestions;

      const today = new Date().toISOString().split('T')[0];
      const maxDate = new Date();
      maxDate.setMonth(maxDate.getMonth() + 3);
      const maxDateStr = maxDate.toISOString().split('T')[0];

      const validateForm = () => {
        const newErrors = {};
        
        if (!clientInfo.evaluatorName.trim()) newErrors.evaluatorName = 'Evaluator name is required';
        if (!clientInfo.parentGuardianName.trim()) newErrors.parentGuardianName = 'Parent/Guardian name is required';
        if (!clientInfo.clientName.trim()) newErrors.clientName = 'Client name is required';
        if (!clientInfo.serviceProviderName.trim()) newErrors.serviceProviderName = 'Service provider name is required';
        if (!clientInfo.email.trim()) {
          newErrors.email = 'Email is required';
        } else if (!/\S+@\S+\.\S+/.test(clientInfo.email)) {
          newErrors.email = 'Email is invalid';
        }
        if (!clientInfo.phone.trim()) newErrors.phone = 'Phone is required';
        if (!clientInfo.address.trim()) newErrors.address = 'Address is required';
        if (!clientInfo.appointmentDate) newErrors.appointmentDate = 'Date is required';
        if (!clientInfo.appointmentTime) newErrors.appointmentTime = 'Time is required';
        if (clientInfo.serviceType.length === 0) newErrors.serviceType = 'Select at least one service type';

        currentQuestions.forEach(q => {
          if (!q.conditional && !evaluationData[q.id] && q.type !== 'textarea') {
            newErrors[q.id] = 'This field is required';
          }
        });

        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        
        if (validateForm()) {
          const timestamp = new Date().toISOString();
          const appointmentId = Date.now();

          const newAppointment = {
            id: appointmentId,
            ...clientInfo,
            status: 'pending',
            submittedAt: timestamp
          };

          const newEvaluation = {
            id: Date.now() + 1,
            appointmentId,
            evaluationType,
            evaluatorName: clientInfo.evaluatorName,
            evaluatorSignature: clientInfo.evaluatorSignature,
            parentGuardianName: clientInfo.parentGuardianName,
            clientName: clientInfo.clientName,
            serviceProviderName: clientInfo.serviceProviderName,
            serviceType: clientInfo.serviceType,
            email: clientInfo.email,
            responses: currentQuestions.map(q => ({
              questionId: q.id,
              question: q.question,
              answer: evaluationData[q.id] || 'Not answered',
              type: q.type
            })),
            submittedAt: timestamp
          };

          // ALWAYS save to localStorage first (for GitHub Pages)
          const updatedAppointments = [...appointments, newAppointment];
          const updatedEvaluations = [...evaluations, newEvaluation];
          
          setAppointments(updatedAppointments);
          setEvaluations(updatedEvaluations);
          
          localStorage.setItem('homeCareAppointments', JSON.stringify(updatedAppointments));
          localStorage.setItem('homeCareEvaluations', JSON.stringify(updatedEvaluations));
          console.log('✅ Data saved to localStorage:', newAppointment);

          // Try to also save to backend API (if available)
          try {
            const result = await HomeCareAPI.submitAppointment(newAppointment, newEvaluation);
            console.log('✅ Data also saved to Google Sheets:', result);
          } catch (error) {
            console.warn('⚠️ Google Sheets save failed:', error);
            console.warn('Data is still saved in localStorage');
          }

          setSubmitted(true);
        }
      };

      const handleReset = () => {
        setClientInfo({
          evaluatorName: '',
          evaluatorSignature: '',
          parentGuardianName: '',
          clientName: '',
          serviceProviderName: '',
          email: '',
          phone: '',
          address: '',
          appointmentDate: '',
          appointmentTime: '',
          serviceType: [],
          notes: ''
        });
        setEvaluationData({});
        setErrors({});
        setSubmitted(false);
        setShowForm(true);
      };

      const updateAppointmentStatus = async (id, newStatus) => {
        try {
          await HomeCareAPI.updateAppointmentStatus(id, newStatus);
          // Reload data from server
          const appointmentsData = await HomeCareAPI.getAppointments();
          setAppointments(appointmentsData);
        } catch (error) {
          console.warn('⚠️ Server unavailable, using localStorage');
          const updated = appointments.map(apt => 
            apt.id === id ? { ...apt, status: newStatus } : apt
          );
          setAppointments(updated);
          localStorage.setItem('homeCareAppointments', JSON.stringify(updated));
        }
      };

      const deleteAppointment = async (id) => {
        try {
          await HomeCareAPI.deleteAppointment(id);
          // Reload data from server
          const [appointmentsData, evaluationsData] = await Promise.all([
            HomeCareAPI.getAppointments(),
            HomeCareAPI.getEvaluations()
          ]);
          setAppointments(appointmentsData);
          setEvaluations(evaluationsData);
        } catch (error) {
          console.warn('⚠️ Server unavailable, using localStorage');
          const updated = appointments.filter(apt => apt.id !== id);
          setAppointments(updated);
          localStorage.setItem('homeCareAppointments', JSON.stringify(updated));
          
          const updatedEvals = evaluations.filter(ev => ev.appointmentId !== id);
          setEvaluations(updatedEvals);
          localStorage.setItem('homeCareEvaluations', JSON.stringify(updatedEvals));
        }
      };

      const deleteEvaluation = async (id) => {
        try {
          await HomeCareAPI.deleteEvaluation(id);
          // Reload data from server
          const evaluationsData = await HomeCareAPI.getEvaluations();
          setEvaluations(evaluationsData);
        } catch (error) {
          console.warn('⚠️ Server unavailable, using localStorage');
          const updated = evaluations.filter(ev => ev.id !== id);
          setEvaluations(updated);
          localStorage.setItem('homeCareEvaluations', JSON.stringify(updated));
        }
      };

      const formatDate = (dateString) => {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
      };

      const formatTime = (timeString) => {
        if (!timeString) return '';
        const [hours, minutes] = timeString.split(':');
        const hour = parseInt(hours);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
        return `${displayHour}:${minutes} ${ampm}`;
      };

      const formatDateTime = (isoString) => {
        return new Date(isoString).toLocaleString('en-US', { 
          month: 'short', 
          day: 'numeric', 
          year: 'numeric',
          hour: '2-digit', 
          minute: '2-digit' 
        });
      };

      const toggleServiceType = (type) => {
        const current = clientInfo.serviceType;
        if (current.includes(type)) {
          setClientInfo({...clientInfo, serviceType: current.filter(t => t !== type)});
        } else {
          setClientInfo({...clientInfo, serviceType: [...current, type]});
        }
      };

      const exportToExcel = () => {
        let csvContent = '';
        
        if (activeTab === 'appointments') {
          const headers = ['ID', 'Evaluator Name', 'Parent/Guardian Name', 'Client Name', 'Service Provider', 'Email', 'Phone', 'Address', 'Service Types', 'Date', 'Time', 'Notes', 'Status', 'Submitted At'];
          
          if (appointments.length === 0) {
            alert('No appointments to export.');
            return;
          }
          
          const rows = appointments.map(apt => [
            `'${apt.id}`,
            apt.evaluatorName || '',
            apt.parentGuardianName || '',
            apt.clientName || '',
            apt.serviceProviderName || '',
            apt.email || '',
            apt.phone || '',
            apt.address || '',
            (apt.serviceType || []).join('; '),
            apt.appointmentDate || '',
            apt.appointmentTime || '',
            apt.notes || '',
            apt.status || 'pending',
            apt.submittedAt ? formatDateTime(apt.submittedAt) : ''
          ]);
          
          csvContent = [
            headers.join(','),
            ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
          ].join('\n');
        } else {
          const headers = ['Evaluation ID', 'Appointment ID', 'Type', 'Evaluator Name', 'Parent/Guardian', 'Client Name', 'Service Provider', 'Service Types', 'Email', 'Responses', 'Submitted At'];
          
          if (evaluations.length === 0) {
            alert('No evaluations to export.');
            return;
          }
          
          const rows = evaluations.map(ev => {
            const responsesText = (ev.responses || [])
              .map(resp => `Q: ${resp.question} | A: ${resp.answer}`)
              .join(' || ');
            
            return [
              `'${ev.id}`,
              `'${ev.appointmentId}`,
              ev.evaluationType === 'staff' ? 'Staff/Service Evaluation' : 'Parental Provider Evaluation',
              ev.evaluatorName || '',
              ev.parentGuardianName || '',
              ev.clientName || '',
              ev.serviceProviderName || '',
              (ev.serviceType || []).join('; '),
              ev.email || '',
              responsesText,
              ev.submittedAt ? formatDateTime(ev.submittedAt) : ''
            ];
          });
          
          csvContent = [
            headers.join(','),
            ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
          ].join('\n');
        }

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `FOR_ALL_HOME_CARE_${activeTab}_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      };

      const exportToWord = () => {
        if (evaluations.length === 0) {
          alert('No evaluations to export. Please submit some evaluations first.');
          return;
        }

        const htmlParts = [];
        
        htmlParts.push('<!DOCTYPE html><html><head><meta charset="UTF-8">');
        htmlParts.push('<title>FOR ALL HOME CARE - Evaluations Report</title>');
        htmlParts.push('<style>');
        htmlParts.push('body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }');
        htmlParts.push('h1 { color: #4F46E5; border-bottom: 3px solid #4F46E5; padding-bottom: 10px; }');
        htmlParts.push('.evaluation { page-break-after: always; margin-bottom: 40px; border: 1px solid #ddd; padding: 20px; }');
        htmlParts.push('.eval-header { background: #EEF2FF; padding: 15px; margin: -20px -20px 20px -20px; }');
        htmlParts.push('.eval-type { color: #10B981; font-weight: bold; font-size: 18px; }');
        htmlParts.push('.info-grid { margin: 20px 0; }');
        htmlParts.push('.info-label { font-weight: bold; color: #4F46E5; display: inline-block; width: 150px; }');
        htmlParts.push('.qa-section { margin: 20px 0; }');
        htmlParts.push('.question { font-weight: bold; color: #1F2937; margin: 15px 0 5px 0; }');
        htmlParts.push('.answer { color: #059669; margin-left: 20px; padding: 8px; background: #F0FDF4; border-left: 3px solid #10B981; }');
        htmlParts.push('</style></head><body>');
        
        htmlParts.push('<h1>FOR ALL HOME CARE AND AGENCY LLC</h1>');
        htmlParts.push('<p><strong>Evaluation Report</strong> - Generated on ' + new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) + '</p>');
        htmlParts.push('<p>Total Evaluations: ' + evaluations.length + '</p><hr>');

        evaluations.forEach((ev, index) => {
          htmlParts.push('<div class="evaluation">');
          htmlParts.push('<div class="eval-header">');
          htmlParts.push('<div class="eval-type">' + (ev.evaluationType === 'staff' ? 'Staff/Service Evaluation' : 'Parental Provider Evaluation') + '</div>');
          htmlParts.push('<div style="font-size: 12px; color: #6B7280; margin-top: 5px;">Evaluation #' + (index + 1) + ' - Submitted ' + formatDateTime(ev.submittedAt) + '</div>');
          htmlParts.push('</div>');
          
          htmlParts.push('<div class="info-grid">');
          htmlParts.push('<p><span class="info-label">Evaluation ID:</span>' + ev.id + '</p>');
          htmlParts.push('<p><span class="info-label">Appointment ID:</span>' + ev.appointmentId + '</p>');
          htmlParts.push('<p><span class="info-label">Evaluator:</span>' + ev.evaluatorName + '</p>');
          htmlParts.push('<p><span class="info-label">Parent/Guardian:</span>' + (ev.parentGuardianName || 'N/A') + '</p>');
          htmlParts.push('<p><span class="info-label">Client Name:</span>' + (ev.clientName || 'N/A') + '</p>');
          htmlParts.push('<p><span class="info-label">Service Provider:</span>' + (ev.serviceProviderName || 'N/A') + '</p>');
          htmlParts.push('<p><span class="info-label">Service Types:</span>' + (ev.serviceType || []).join(', ') + '</p>');
          htmlParts.push('<p><span class="info-label">Email:</span>' + ev.email + '</p>');
          htmlParts.push('</div>');
          
          htmlParts.push('<h3 style="color: #4F46E5; border-bottom: 2px solid #E0E7FF; padding-bottom: 5px;">Responses</h3>');
          htmlParts.push('<div class="qa-section">');
          
          (ev.responses || []).forEach((resp, qIndex) => {
            htmlParts.push('<div class="question">' + (qIndex + 1) + '. ' + resp.question + '</div>');
            htmlParts.push('<div class="answer">' + resp.answer + '</div>');
          });
          
          htmlParts.push('</div></div>');
        });

        htmlParts.push('<div style="text-align: center; color: #6B7280; font-size: 12px; margin-top: 30px;">');
        htmlParts.push('<p>FOR ALL HOME CARE AND AGENCY LLC - Confidential Document</p>');
        htmlParts.push('<p>This report contains ' + evaluations.length + ' evaluation(s)</p>');
        htmlParts.push('</div>');
        htmlParts.push('</body></html>');

        const htmlContent = htmlParts.join('');
        const blob = new Blob([htmlContent], { type: 'application/msword' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `FOR_ALL_HOME_CARE_Evaluations_${new Date().toISOString().split('T')[0]}.doc`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      };

      const exportToPDF = () => {
        if (evaluations.length === 0) {
          alert('No evaluations to export. Please submit some evaluations first.');
          return;
        }

        const htmlParts = [];
        
        htmlParts.push('<!DOCTYPE html><html><head><meta charset="UTF-8">');
        htmlParts.push('<title>FOR ALL HOME CARE - Evaluations Report</title>');
        htmlParts.push('<style>');
        htmlParts.push('@media print { body { margin: 0; } .evaluation { page-break-after: always; } }');
        htmlParts.push('body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }');
        htmlParts.push('h1 { color: #4F46E5; border-bottom: 3px solid #4F46E5; padding-bottom: 10px; }');
        htmlParts.push('.evaluation { margin-bottom: 40px; border: 1px solid #ddd; padding: 20px; }');
        htmlParts.push('.eval-header { background: #EEF2FF; padding: 15px; margin: -20px -20px 20px -20px; }');
        htmlParts.push('.eval-type { color: #10B981; font-weight: bold; font-size: 18px; }');
        htmlParts.push('.info-grid { margin: 20px 0; }');
        htmlParts.push('.info-label { font-weight: bold; color: #4F46E5; display: inline-block; width: 150px; }');
        htmlParts.push('.qa-section { margin: 20px 0; }');
        htmlParts.push('.question { font-weight: bold; color: #1F2937; margin: 15px 0 5px 0; }');
        htmlParts.push('.answer { color: #059669; margin-left: 20px; padding: 8px; background: #F0FDF4; border-left: 3px solid #10B981; }');
        htmlParts.push('</style></head><body>');
        
        htmlParts.push('<h1>FOR ALL HOME CARE AND AGENCY LLC</h1>');
        htmlParts.push('<p><strong>Evaluation Report</strong> - Generated on ' + new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) + '</p>');
        htmlParts.push('<p>Total Evaluations: ' + evaluations.length + '</p><hr>');

        evaluations.forEach((ev, index) => {
          htmlParts.push('<div class="evaluation">');
          htmlParts.push('<div class="eval-header">');
          htmlParts.push('<div class="eval-type">' + (ev.evaluationType === 'staff' ? 'Staff/Service Evaluation' : 'Parental Provider Evaluation') + '</div>');
          htmlParts.push('<div style="font-size: 12px; color: #6B7280; margin-top: 5px;">Evaluation #' + (index + 1) + ' - Submitted ' + formatDateTime(ev.submittedAt) + '</div>');
          htmlParts.push('</div>');
          
          htmlParts.push('<div class="info-grid">');
          htmlParts.push('<p><span class="info-label">Evaluation ID:</span>' + ev.id + '</p>');
          htmlParts.push('<p><span class="info-label">Appointment ID:</span>' + ev.appointmentId + '</p>');
          htmlParts.push('<p><span class="info-label">Evaluator:</span>' + ev.evaluatorName + '</p>');
          htmlParts.push('<p><span class="info-label">Parent/Guardian:</span>' + (ev.parentGuardianName || 'N/A') + '</p>');
          htmlParts.push('<p><span class="info-label">Client Name:</span>' + (ev.clientName || 'N/A') + '</p>');
          htmlParts.push('<p><span class="info-label">Service Provider:</span>' + (ev.serviceProviderName || 'N/A') + '</p>');
          htmlParts.push('<p><span class="info-label">Service Types:</span>' + (ev.serviceType || []).join(', ') + '</p>');
          htmlParts.push('<p><span class="info-label">Email:</span>' + ev.email + '</p>');
          htmlParts.push('</div>');
          
          htmlParts.push('<h3 style="color: #4F46E5; border-bottom: 2px solid #E0E7FF; padding-bottom: 5px;">Responses</h3>');
          htmlParts.push('<div class="qa-section">');
          
          (ev.responses || []).forEach((resp, qIndex) => {
            htmlParts.push('<div class="question">' + (qIndex + 1) + '. ' + resp.question + '</div>');
            htmlParts.push('<div class="answer">' + resp.answer + '</div>');
          });
          
          htmlParts.push('</div></div>');
        });

        htmlParts.push('<div style="text-align: center; color: #6B7280; font-size: 12px; margin-top: 30px;">');
        htmlParts.push('<p>FOR ALL HOME CARE AND AGENCY LLC - Confidential Document</p>');
        htmlParts.push('<p>This report contains ' + evaluations.length + ' evaluation(s)</p>');
        htmlParts.push('</div>');
        
        // Auto-print without closing script tag issue
        htmlParts.push('<script' + ' type="text/javascript">window.onload = function() { window.print(); };</script' + '>');
        htmlParts.push('</body></html>');

        const htmlContent = htmlParts.join('');
        const printWindow = window.open('', '_blank');
        printWindow.document.write(htmlContent);
        printWindow.document.close();
      };

      const renderQuestionInput = (q) => {
        if (q.conditional) {
          const parentId = q.id.replace('_desc', '');
          if (evaluationData[parentId] !== 'Yes') {
            return null;
          }
        }

        const createButtons = (options) => (
          <div className={`${options.length > 3 ? 'grid grid-cols-2' : 'flex'} gap-3`}>
            {options.map(opt => (
              <button
                key={opt}
                type="button"
                onClick={() => setEvaluationData({...evaluationData, [q.id]: opt})}
                className={`py-3 rounded-lg border-2 font-semibold transition-all ${
                  evaluationData[q.id] === opt
                    ? 'border-indigo-600 bg-indigo-600 text-white'
                    : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400'
                } ${options.length <= 3 ? 'flex-1' : ''}`}
              >
                {opt}
              </button>
            ))}
          </div>
        );

        switch (q.type) {
          case 'yesnosometimes':
            return createButtons(['Yes', 'No', 'Sometimes']);
          case 'yesnosomewhat':
            return createButtons(['Yes', 'No', 'Somewhat']);
          case 'yesnonotsure':
            return createButtons(['Yes', 'No', 'Not sure']);
          case 'yesnoundecided':
            return createButtons(['Yes', 'No', 'Undecided']);
          case 'yesnopartially':
            return createButtons(['Yes', 'No', 'Partially']);
          case 'alwayssometimesrarely':
            return createButtons(['Always', 'Sometimes', 'Rarely']);
          case 'evvrating':
            return createButtons(['Yes', 'No', 'Sometimes', 'Needs improvement']);
          case 'compensation':
            return createButtons(['Great', 'Fair', 'Unfair', 'Needs improvement']);
          case 'rating5':
            return (
              <div className="flex gap-2">
                {['1 (Poor)', '2', '3', '4', '5 (Excellent)'].map((rating) => (
                  <button
                    key={rating}
                    type="button"
                    onClick={() => setEvaluationData({...evaluationData, [q.id]: rating})}
                    className={`flex-1 py-3 rounded-lg border-2 font-semibold transition-all ${
                      evaluationData[q.id] === rating
                        ? 'border-indigo-600 bg-indigo-600 text-white'
                        : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400'
                    }`}
                  >
                    {rating}
                  </button>
                ))}
              </div>
            );
          case 'textarea':
            return (
              <textarea
                value={evaluationData[q.id] || ''}
                onChange={(e) => setEvaluationData({...evaluationData, [q.id]: e.target.value})}
                rows="3"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none"
                placeholder="Your response..."
              />
            );
          default:
            return null;
        }
      };

      // ADMIN PANEL
      if (isAdmin) {
        const pendingCount = appointments.filter(a => a.status === 'pending').length;
        const approvedCount = appointments.filter(a => a.status === 'approved').length;

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
            <div className="max-w-7xl mx-auto">
              <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                <h1 className="text-4xl font-bold text-gray-800 mb-2">FOR ALL HOME CARE AND AGENCY LLC</h1>
                <p className="text-gray-600">Admin Dashboard - Manage appointments and evaluations</p>
              </div>

              {showPowerAppsInfo && (
                <div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl shadow-xl p-6 mb-6 text-white">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-3">
                        <Cloud className="w-6 h-6" />
                        <h2 className="text-2xl font-bold">Recommended Upgrade: Microsoft Power Apps + Dataverse</h2>
                      </div>
                      <p className="text-blue-100 mb-4">
                        For a professional home care agency system, consider upgrading to Microsoft Power Apps + Dataverse for enhanced security, compliance, and scalability.
                      </p>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-white/10 backdrop-blur-sm p-4 rounded-lg">
                          <div className="flex items-center gap-2 mb-2">
                            <Shield className="w-5 h-5" />
                            <h3 className="font-semibold">HIPAA Compliance</h3>
                          </div>
                          <p className="text-sm text-blue-100">HIPAA-compliant option available for patient data protection</p>
                        </div>
                        <div className="bg-white/10 backdrop-blur-sm p-4 rounded-lg">
                          <div className="flex items-center gap-2 mb-2">
                            <Zap className="w-5 h-5" />
                            <h3 className="font-semibold">Easy Management</h3>
                          </div>
                          <p className="text-sm text-blue-100">No coding required for admins to manage the system</p>
                        </div>
                        <div className="bg-white/10 backdrop-blur-sm p-4 rounded-lg">
                          <div className="flex items-center gap-2 mb-2">
                            <CheckCircle className="w-5 h-5" />
                            <h3 className="font-semibold">Microsoft 365 Integration</h3>
                          </div>
                          <p className="text-sm text-blue-100">Part of Microsoft 365 (you may already have access)</p>
                        </div>
                        <div className="bg-white/10 backdrop-blur-sm p-4 rounded-lg">
                          <div className="flex items-center gap-2 mb-2">
                            <Cloud className="w-5 h-5" />
                            <h3 className="font-semibold">Secure & Automated</h3>
                          </div>
                          <p className="text-sm text-blue-100">Automatic backups, secure cloud storage, connects to Excel & email</p>
                        </div>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowPowerAppsInfo(false)}
                      className="ml-4 text-white/80 hover:text-white transition-colors"
                    >
                      <XCircle className="w-6 h-6" />
                    </button>
                  </div>
                </div>
              )}

              <div className="grid grid-cols-4 gap-4 mb-6">
                <div className="bg-yellow-50 p-5 rounded-xl border border-yellow-200">
                  <p className="text-yellow-800 text-sm font-medium">Pending</p>
                  <p className="text-3xl font-bold text-yellow-900">{pendingCount}</p>
                </div>
                <div className="bg-green-50 p-5 rounded-xl border border-green-200">
                  <p className="text-green-800 text-sm font-medium">Approved</p>
                  <p className="text-3xl font-bold text-green-900">{approvedCount}</p>
                </div>
                <div className="bg-blue-50 p-5 rounded-xl border border-blue-200">
                  <p className="text-blue-800 text-sm font-medium">Total Evaluations</p>
                  <p className="text-3xl font-bold text-blue-900">{evaluations.length}</p>
                </div>
                <div className="bg-purple-50 p-5 rounded-xl border border-purple-200">
                  <p className="text-purple-800 text-sm font-medium">Total Appointments</p>
                  <p className="text-3xl font-bold text-purple-900">{appointments.length}</p>
                </div>
              </div>

              <div className="bg-white rounded-t-2xl shadow-xl">
                <div className="flex border-b border-gray-200">
                  <button
                    onClick={() => setActiveTab('appointments')}
                    className={`flex items-center gap-2 px-8 py-4 font-semibold transition-colors ${
                      activeTab === 'appointments'
                        ? 'text-indigo-600 border-b-2 border-indigo-600'
                        : 'text-gray-500 hover:text-gray-700'
                    }`}
                  >
                    <Calendar className="w-5 h-5" />
                    Appointments
                  </button>
                  <button
                    onClick={() => setActiveTab('evaluations')}
                    className={`flex items-center gap-2 px-8 py-4 font-semibold transition-colors ${
                      activeTab === 'evaluations'
                        ? 'text-indigo-600 border-b-2 border-indigo-600'
                        : 'text-gray-500 hover:text-gray-700'
                    }`}
                  >
                    <ClipboardList className="w-5 h-5" />
                    Evaluations
                  </button>
                </div>

                <div className="p-6">
                  <div className="mb-4 flex gap-3 flex-wrap">
                    <button
                      onClick={exportToExcel}
                      className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors"
                    >
                      <Download className="w-4 h-4" />
                      Export to Excel
                    </button>
                    
                    {activeTab === 'evaluations' && (
                      <>
                        <button
                          onClick={exportToWord}
                          className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          <FileText className="w-4 h-4" />
                          Export to Word
                        </button>
                        
                        <button
                          onClick={exportToPDF}
                          className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                        >
                          <FileText className="w-4 h-4" />
                          Export to PDF
                        </button>
                      </>
                    )}
                  </div>

                  {activeTab === 'appointments' && (
                    <div className="space-y-4">
                      {appointments.length === 0 ? (
                        <div className="text-center py-12">
                          <Users className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                          <h3 className="text-xl font-semibold text-gray-600 mb-2">No appointments yet</h3>
                          <p className="text-gray-500">Appointments will appear here when clients submit requests</p>
                        </div>
                      ) : (
                        appointments.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt)).map((apt) => (
                          <div key={apt.id} className="bg-gray-50 rounded-xl p-6 border border-gray-200">
                            <div className="flex items-start justify-between mb-4">
                              <div>
                                <div className="flex items-center gap-3 mb-2">
                                  <h3 className="text-xl font-bold text-gray-800">{apt.clientName}</h3>
                                  <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                    apt.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                    apt.status === 'approved' ? 'bg-green-100 text-green-800' :
                                    'bg-red-100 text-red-800'
                                  }`}>
                                    {apt.status.toUpperCase()}
                                  </span>
                                </div>
                                <p className="text-sm text-gray-500">Submitted: {formatDateTime(apt.submittedAt)}</p>
                              </div>
                            </div>

                            <div className="grid grid-cols-2 gap-4 mb-4">
                              <div>
                                <p className="text-sm font-medium text-gray-700">Evaluator</p>
                                <p className="text-gray-900">{apt.evaluatorName}</p>
                              </div>
                              <div>
                                <p className="text-sm font-medium text-gray-700">Parent/Guardian</p>
                                <p className="text-gray-900">{apt.parentGuardianName}</p>
                              </div>
                              <div>
                                <p className="text-sm font-medium text-gray-700">Service Provider</p>
                                <p className="text-gray-900">{apt.serviceProviderName}</p>
                              </div>
                              <div>
                                <p className="text-sm font-medium text-gray-700">Appointment</p>
                                <p className="text-gray-900 font-semibold">{formatDate(apt.appointmentDate)}</p>
                                <p className="text-gray-900 font-semibold">{formatTime(apt.appointmentTime)}</p>
                              </div>
                              <div>
                                <p className="text-sm font-medium text-gray-700">Contact</p>
                                <p className="text-gray-900">{apt.email}</p>
                                <p className="text-gray-900">{apt.phone}</p>
                              </div>
                              <div>
                                <p className="text-sm font-medium text-gray-700">Service Types</p>
                                <p className="text-gray-900">{apt.serviceType.join(', ')}</p>
                              </div>
                              <div className="col-span-2">
                                <p className="text-sm font-medium text-gray-700">Address</p>
                                <p className="text-gray-900">{apt.address}</p>
                              </div>
                              {apt.notes && (
                                <div className="col-span-2">
                                  <p className="text-sm font-medium text-gray-700">Notes</p>
                                  <p className="text-gray-900 bg-white p-3 rounded border">{apt.notes}</p>
                                </div>
                              )}
                            </div>

                            <div className="flex gap-2">
                              {apt.status === 'pending' && (
                                <>
                                  <button
                                    onClick={() => updateAppointmentStatus(apt.id, 'approved')}
                                    className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm"
                                  >
                                    <CheckCircle className="w-4 h-4" />
                                    Approve
                                  </button>
                                  <button
                                    onClick={() => updateAppointmentStatus(apt.id, 'declined')}
                                    className="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm"
                                  >
                                    <XCircle className="w-4 h-4" />
                                    Decline
                                  </button>
                                </>
                              )}
                              <button
                                onClick={() => deleteAppointment(apt.id)}
                                className="ml-auto flex items-center gap-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors text-sm"
                              >
                                <Trash2 className="w-4 h-4" />
                                Delete
                              </button>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  )}

                  {activeTab === 'evaluations' && (
                    <div className="space-y-4">
                      {evaluations.length === 0 ? (
                        <div className="text-center py-12">
                          <FileText className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                          <h3 className="text-xl font-semibold text-gray-600 mb-2">No evaluations yet</h3>
                          <p className="text-gray-500">Evaluation forms will appear here when submitted</p>
                        </div>
                      ) : (
                        evaluations.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt)).map((ev) => (
                          <div key={ev.id} className="bg-gray-50 rounded-xl p-6 border border-gray-200">
                            <div className="flex items-start justify-between mb-4">
                              <div className="flex-1">
                                <h3 className="text-xl font-bold text-gray-800 mb-1">{ev.clientName}</h3>
                                <div className="grid grid-cols-2 gap-x-4 text-sm text-gray-600 mb-3">
                                  <p><span className="font-medium">Evaluator:</span> {ev.evaluatorName}</p>
                                  <p><span className="font-medium">Parent/Guardian:</span> {ev.parentGuardianName}</p>
                                  <p><span className="font-medium">Service Provider:</span> {ev.serviceProviderName}</p>
                                  <p><span className="font-medium">Email:</span> {ev.email}</p>
                                  <p className="col-span-2"><span className="font-medium">Services:</span> {ev.serviceType.join(', ')}</p>
                                </div>
                                <div className="flex items-center gap-2">
                                  <span className="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-xs font-semibold">
                                    {ev.evaluationType === 'staff' ? 'Staff/Service Evaluation' : 'Parental Provider Evaluation'}
                                  </span>
                                  <span className="text-sm text-gray-500">
                                    {formatDateTime(ev.submittedAt)}
                                  </span>
                                </div>
                              </div>
                              <button
                                onClick={() => deleteEvaluation(ev.id)}
                                className="flex items-center gap-2 bg-gray-300 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-400 transition-colors text-sm"
                              >
                                <Trash2 className="w-4 h-4" />
                              </button>
                            </div>

                            <div className="space-y-3">
                              {ev.responses.filter(r => r.answer !== 'Not answered').map((resp, idx) => (
                                <div key={idx} className="bg-white p-4 rounded-lg border">
                                  <p className="text-sm font-medium text-gray-700 mb-2">{resp.question}</p>
                                  <p className="text-gray-900 font-semibold">{resp.answer}</p>
                                </div>
                              ))}
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      // SUCCESS SCREEN
      if (submitted) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full text-center">
              <div className="mb-6">
                <div className="mx-auto w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-4">
                  <CheckCircle className="w-12 h-12 text-green-600" />
                </div>
                <h2 className="text-3xl font-bold text-gray-800 mb-2">Thank You!</h2>
                <p className="text-gray-600">Your appointment request and evaluation have been submitted successfully to FOR ALL HOME CARE AND AGENCY LLC.</p>
              </div>

              <div className="bg-indigo-50 rounded-lg p-6 mb-6 text-left">
                <h3 className="font-semibold text-indigo-900 mb-3">Submission Summary</h3>
                <div className="space-y-2 text-sm">
                  <p><span className="font-medium text-gray-700">Client Name:</span> <span className="text-gray-600">{clientInfo.clientName}</span></p>
                  <p><span className="font-medium text-gray-700">Parent/Guardian:</span> <span className="text-gray-600">{clientInfo.parentGuardianName}</span></p>
                  <p><span className="font-medium text-gray-700">Service Provider:</span> <span className="text-gray-600">{clientInfo.serviceProviderName}</span></p>
                  <p><span className="font-medium text-gray-700">Email:</span> <span className="text-gray-600">{clientInfo.email}</span></p>
                  <p><span className="font-medium text-gray-700">Appointment:</span> <span className="text-gray-600">{formatDate(clientInfo.appointmentDate)} at {formatTime(clientInfo.appointmentTime)}</span></p>
                  <p><span className="font-medium text-gray-700">Service Types:</span> <span className="text-gray-600">{clientInfo.serviceType.join(', ')}</span></p>
                  <p><span className="font-medium text-gray-700">Evaluation Type:</span> <span className="text-gray-600">{evaluationType === 'staff' ? 'Staff/Service Evaluation' : 'Parental Provider Evaluation'}</span></p>
                </div>
              </div>

              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <p className="text-sm text-blue-800">
                  Our team will review your request and contact you at <strong>{clientInfo.email}</strong> or <strong>{clientInfo.phone}</strong> within 24 hours to confirm your appointment.
                </p>
              </div>

              <button
                onClick={handleReset}
                className="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
              >
                Submit Another Form
              </button>
            </div>
          </div>
        );
      }

      // CLIENT FORM
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
          <div className="max-w-4xl mx-auto">
            {showPowerAppsInfo && (
              <div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl shadow-xl p-6 mb-6 text-white">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-3">
                      <Info className="w-6 h-6" />
                      <h2 className="text-xl font-bold">System Information</h2>
                    </div>
                    <p className="text-blue-100 mb-3">
                      This agency is exploring Microsoft Power Apps + Dataverse for enhanced security and compliance.
                    </p>
                    <div className="flex flex-wrap gap-2">
                      <span className="bg-white/20 px-3 py-1 rounded-full text-sm font-medium">✓ HIPAA Compliant</span>
                      <span className="bg-white/20 px-3 py-1 rounded-full text-sm font-medium">✓ Secure Cloud Storage</span>
                      <span className="bg-white/20 px-3 py-1 rounded-full text-sm font-medium">✓ Microsoft 365 Integration</span>
                      <span className="bg-white/20 px-3 py-1 rounded-full text-sm font-medium">✓ Automatic Backups</span>
                    </div>
                  </div>
                  <button
                    onClick={() => setShowPowerAppsInfo(false)}
                    className="ml-4 text-white/80 hover:text-white transition-colors"
                  >
                    <XCircle className="w-6 h-6" />
                  </button>
                </div>
              </div>
            )}

            <div className="bg-white rounded-2xl shadow-2xl p-8">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-gray-800 mb-2">FOR ALL HOME CARE AND AGENCY LLC</h1>
                <p className="text-xl text-gray-700 mb-1">Appointment Request & Evaluation Form</p>
                <p className="text-gray-600">Complete your appointment request and evaluation in one form</p>
              </div>

              <form onSubmit={handleSubmit} className="space-y-6">
                <div className="bg-gray-50 p-6 rounded-xl">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Form Information</h2>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Evaluation Filled by (Your Name) *</label>
                      <input
                        type="text"
                        value={clientInfo.evaluatorName}
                        onChange={(e) => setClientInfo({...clientInfo, evaluatorName: e.target.value})}
                        className={`w-full px-4 py-3 border ${errors.evaluatorName ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                        placeholder="Your name"
                      />
                      {errors.evaluatorName && <p className="mt-1 text-sm text-red-600">{errors.evaluatorName}</p>}
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Signature</label>
                      <input
                        type="text"
                        value={clientInfo.evaluatorSignature}
                        onChange={(e) => setClientInfo({...clientInfo, evaluatorSignature: e.target.value})}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                        placeholder="Type your name as signature"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Parent/Guardian Name *</label>
                      <input
                        type="text"
                        value={clientInfo.parentGuardianName}
                        onChange={(e) => setClientInfo({...clientInfo, parentGuardianName: e.target.value})}
                        className={`w-full px-4 py-3 border ${errors.parentGuardianName ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                        placeholder="Parent or guardian name"
                      />
                      {errors.parentGuardianName && <p className="mt-1 text-sm text-red-600">{errors.parentGuardianName}</p>}
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Client Name *</label>
                      <input
                        type="text"
                        value={clientInfo.clientName}
                        onChange={(e) => setClientInfo({...clientInfo, clientName: e.target.value})}
                        className={`w-full px-4 py-3 border ${errors.clientName ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                        placeholder="Client receiving services"
                      />
                      {errors.clientName && <p className="mt-1 text-sm text-red-600">{errors.clientName}</p>}
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-gray-700 mb-2">Service Provider Name *</label>
                      <input
                        type="text"
                        value={clientInfo.serviceProviderName}
                        onChange={(e) => setClientInfo({...clientInfo, serviceProviderName: e.target.value})}
                        className={`w-full px-4 py-3 border ${errors.serviceProviderName ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                        placeholder="Name of staff providing services"
                      />
                      {errors.serviceProviderName && <p className="mt-1 text-sm text-red-600">{errors.serviceProviderName}</p>}
                    </div>
                  </div>
                </div>

                <div className="bg-gray-50 p-6 rounded-xl">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Service Type(s) *</h2>
                  <div className="grid grid-cols-2 gap-3">
                    {serviceTypes.map(type => (
                      <button
                        key={type}
                        type="button"
                        onClick={() => toggleServiceType(type)}
                        className={`p-3 rounded-lg border-2 transition-all text-left ${
                          clientInfo.serviceType.includes(type)
                            ? 'border-indigo-600 bg-indigo-50 text-indigo-900 font-semibold'
                            : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400'
                        }`}
                      >
                        <span className="text-sm">{clientInfo.serviceType.includes(type) ? '☑' : '☐'}</span> {type}
                      </button>
                    ))}
                  </div>
                  {errors.serviceType && <p className="mt-2 text-sm text-red-600">{errors.serviceType}</p>}
                </div>

                <div className="bg-gray-50 p-6 rounded-xl">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Contact Information</h2>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                      <input
                        type="email"
                        value={clientInfo.email}
                        onChange={(e) => setClientInfo({...clientInfo, email: e.target.value})}
                        className={`w-full px-4 py-3 border ${errors.email ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                        placeholder="your@email.com"
                      />
                      {errors.email && <p className="mt-1 text-sm text-red-600">{errors.email}</p>}
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
                      <input
                        type="tel"
                        value={clientInfo.phone}
                        onChange={(e) => setClientInfo({...clientInfo, phone: e.target.value})}
                        className={`w-full px-4 py-3 border ${errors.phone ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                        placeholder="(555) 123-4567"
                      />
                      {errors.phone && <p className="mt-1 text-sm text-red-600">{errors.phone}</p>}
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-gray-700 mb-2">Address *</label>
                      <textarea
                        value={clientInfo.address}
                        onChange={(e) => setClientInfo({...clientInfo, address: e.target.value})}
                        rows="2"
                        className={`w-full px-4 py-3 border ${errors.address ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none`}
                        placeholder="123 Main St, City, State, ZIP"
                      />
                      {errors.address && <p className="mt-1 text-sm text-red-600">{errors.address}</p>}
                    </div>
                  </div>
                </div>

                <div className="bg-gray-50 p-6 rounded-xl">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Appointment Details</h2>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Date of Evaluation *</label>
                      <input
                        type="date"
                        value={clientInfo.appointmentDate}
                        onChange={(e) => setClientInfo({...clientInfo, appointmentDate: e.target.value})}
                        min={today}
                        max={maxDateStr}
                        className={`w-full px-4 py-3 border ${errors.appointmentDate ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                      />
                      {errors.appointmentDate && <p className="mt-1 text-sm text-red-600">{errors.appointmentDate}</p>}
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Preferred Time *</label>
                      <input
                        type="time"
                        value={clientInfo.appointmentTime}
                        onChange={(e) => setClientInfo({...clientInfo, appointmentTime: e.target.value})}
                        className={`w-full px-4 py-3 border ${errors.appointmentTime ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none`}
                      />
                      {errors.appointmentTime && <p className="mt-1 text-sm text-red-600">{errors.appointmentTime}</p>}
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-gray-700 mb-2">Additional Notes</label>
                      <textarea
                        value={clientInfo.notes}
                        onChange={(e) => setClientInfo({...clientInfo, notes: e.target.value})}
                        rows="3"
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none"
                        placeholder="Any special requirements or information..."
                      />
                    </div>
                  </div>
                </div>

                <div className="bg-indigo-50 p-6 rounded-xl border-2 border-indigo-200">
                  <h2 className="text-2xl font-bold text-gray-800 mb-4">Evaluation Form</h2>
                  
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-3">Select Evaluation Type *</label>
                    <div className="grid grid-cols-2 gap-4">
                      <button
                        type="button"
                        onClick={() => setEvaluationType('staff')}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          evaluationType === 'staff'
                            ? 'border-indigo-600 bg-indigo-600 text-white'
                            : 'border-gray-300 bg-white hover:border-gray-400'
                        }`}
                      >
                        <h3 className="font-bold">Staff / Service Evaluation</h3>
                        <p className="text-sm mt-1">For families evaluating staff who provide services in the home</p>
                      </button>
                      <button
                        type="button"
                        onClick={() => setEvaluationType('parental')}
                        className={`p-4 rounded-lg border-2 transition-all ${
                          evaluationType === 'parental'
                            ? 'border-indigo-600 bg-indigo-600 text-white'
                            : 'border-gray-300 bg-white hover:border-gray-400'
                        }`}
                      >
                        <h3 className="font-bold">Parental Provider Evaluation</h3>
                        <p className="text-sm mt-1">For parents or guardians who provide services through the agency</p>
                      </button>
                    </div>
                  </div>

                  <div className="space-y-5">
                    {currentQuestions.map((q) => {
                      const input = renderQuestionInput(q);
                      if (!input) return null;

                      return (
                        <div key={q.id} className="bg-white p-5 rounded-lg border border-gray-200">
                          <label className="block text-sm font-medium text-gray-800 mb-3">
                            {q.question} {!q.conditional && q.type !== 'textarea' && '*'}
                          </label>
                          {input}
                          {errors[q.id] && <p className="mt-2 text-sm text-red-600">{errors[q.id]}</p>}
                        </div>
                      );
                    })}
                  </div>
                </div>

                <button
                  type="submit"
                  className="w-full bg-indigo-600 text-white py-4 px-6 rounded-lg font-bold text-lg hover:bg-indigo-700 transition-colors shadow-lg hover:shadow-xl"
                >
                  Submit Appointment & Evaluation Form
                </button>
              </form>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<HomeCareAgencySystem />, document.getElementById('root'));
  </script>
</body>
</html>
